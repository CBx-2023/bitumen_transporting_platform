<!-- pages/order/list.wxml -->
<navigation-bar title="订单列表" back="{{false}}" color="white" background="#2c3e50"></navigation-bar>
<view class="container">
  <!-- 标签页导航 -->
  <view class="tabs">
    <view class="tab {{activeTab === '0' ? 'active' : ''}}" bindtap="switchTab" data-index="0">全部</view>
    <view class="tab {{activeTab === '1' ? 'active' : ''}}" bindtap="switchTab" data-index="1">待接单</view>
    <view class="tab {{activeTab === '2' ? 'active' : ''}}" bindtap="switchTab" data-index="2">运输中</view>
    <view class="tab {{activeTab === '3' ? 'active' : ''}}" bindtap="switchTab" data-index='3'>已完成</view>
  </view>
  
  <!-- 订单列表 -->
  <scroll-view class="order-list-container" scroll-y>
    <block wx:if="{{filteredOrders.length > 0}}">
      <view class="order-item" wx:for="{{filteredOrders}}" wx:key="id">
        <view class="order-header">
          <text class="order-id">订单号：{{item.id}}</text>
          <text class="order-status {{item.status === '待接单' ? 'status-waiting' : (item.status === '运输中' ? 'status-inprogress' : 'status-completed')}}">{{item.status}}</text>
        </view>
        
        <view class="order-content" bindtap="viewOrderDetail" data-id="{{item.id}}">
          <view class="order-route">
            <view class="location-item">
              <view class="location-dot start-dot"></view>
              <text class="location-text">{{item.startLocation}}</text>
            </view>
            <view class="route-line"></view>
            <view class="location-item">
              <view class="location-dot end-dot"></view>
              <text class="location-text">{{item.endLocation}}</text>
            </view>
          </view>
          
          <view class="order-info">
            <view class="info-item">
              <text class="info-label">货物类型：</text>
              <text class="info-value">{{item.goodsType}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">重量：</text>
              <text class="info-value">{{item.weight}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">创建时间：</text>
              <text class="info-value">{{item.createTime}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">运费：</text>
              <text class="info-value price">{{item.price}}</text>
            </view>
            
            <!-- 司机信息（如果有） -->
            <block wx:if="{{item.driverInfo && (userRole === 'owner' || userRole === 'supervisor')}}">
              <view class="participant-info">
                <view class="participant-header">司机信息</view>
                <view class="info-item">
                  <text class="info-label">姓名：</text>
                  <text class="info-value">{{item.driverInfo.name}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">联系电话：</text>
                  <text class="info-value">{{item.driverInfo.phone}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">车牌号：</text>
                  <text class="info-value">{{item.driverInfo.carNumber}}</text>
                </view>
              </view>
            </block>
            
            <!-- 货主信息（如果是司机或监管） -->
            <block wx:if="{{userRole === 'driver' || userRole === 'supervisor'}}">
              <view class="participant-info">
                <view class="participant-header">货主信息</view>
                <view class="info-item">
                  <text class="info-label">姓名：</text>
                  <text class="info-value">{{item.ownerInfo.name}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">联系电话：</text>
                  <text class="info-value">{{item.ownerInfo.phone}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">公司：</text>
                  <text class="info-value">{{item.ownerInfo.company}}</text>
                </view>
              </view>
            </block>
            
            <!-- 完成时间（如果已完成） -->
            <block wx:if="{{item.status === '已完成'}}">
              <view class="info-item">
                <text class="info-label">完成时间：</text>
                <text class="info-value">{{item.completeTime}}</text>
              </view>
            </block>
          </view>
        </view>
        
        <view class="order-actions">
          <!-- 司机操作 -->
          <block wx:if="{{userRole === 'driver'}}">
            <block wx:if="{{item.status === '待接单'}}">
              <button class="action-btn primary" bindtap="takeOrder" data-id="{{item.id}}">接单</button>
            </block>
            <block wx:if="{{item.status === '运输中'}}">
              <button class="action-btn primary" bindtap="completeOrder" data-id="{{item.id}}">完成订单</button>
            </block>
          </block>
          
          <!-- 货主操作 -->
          <block wx:if="{{userRole === 'owner'}}">
            <block wx:if="{{item.status === '待接单'}}">
              <button class="action-btn danger" bindtap="cancelOrder" data-id="{{item.id}}">取消订单</button>
            </block>
            <block wx:if="{{item.status === '运输中'}}">
              <button class="action-btn primary" bindtap="confirmReceipt" data-id="{{item.id}}">确认收货</button>
            </block>
          </block>
        </view>
      </view>
    </block>
    
    <view wx:if="{{filteredOrders.length === 0}}" class="empty-list">
      <image class="empty-icon" src="/pages/images/empty.png" mode="aspectFit"></image>
      <text class="empty-text">暂无订单</text>
    </view>
  </scroll-view>
</view>